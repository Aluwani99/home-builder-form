<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Builder Submission Form</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #64748b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --light: #f8fafc;
      --dark: #1e293b;
      --gray: #94a3b8;
      --radius: 12px;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .form-container {
      width: 100%;
      max-width: 800px;
      background: #fff;
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .form-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    .logo {
      height: 70px;
      margin-bottom: 15px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
      counter-reset: step;
    }

    .progress-bar::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      width: 100%;
      height: 4px;
      background-color: #e2e8f0;
      z-index: 1;
    }

    .progress-line {
      position: absolute;
      top: 15px;
      left: 0;
      width: 0%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
      z-index: 2;
      transition: var(--transition);
    }

    .step-progress {
      position: relative;
      z-index: 3;
      text-align: center;
      width: 40px;
      height: 40px;
      background-color: white;
      border: 4px solid #e2e8f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--secondary);
      transition: var(--transition);
    }

    .step-progress.active {
      border-color: var(--primary);
      color: var(--primary);
      background-color: #dbeafe;
    }

    .step-progress.completed {
      border-color: var(--success);
      background-color: var(--success);
      color: white;
    }

    .step-label {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: var(--secondary);
      white-space: nowrap;
    }

    .form-section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-section.active {
      display: block;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 20px;
      color: var(--primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      background: var(--primary);
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    label.required::after {
      content: "*";
      color: var(--danger);
    }

    .input-container {
      position: relative;
    }

    select, input, textarea {
      width: 100%;
      padding: 14px 16px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      font-size: 16px;
      transition: var(--transition);
      background-color: var(--light);
    }

    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .file-upload-container {
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      padding: 25px;
      text-align: center;
      transition: var(--transition);
      background-color: #f8fafc;
      cursor: pointer;
    }

    .file-upload-container:hover {
      border-color: var(--primary);
      background-color: #f0f9ff;
    }

    .file-upload-icon {
      font-size: 40px;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .file-input {
      position: absolute;
      width: 0;
      height: 0;
      opacity: 0;
      overflow: hidden;
    }

    .file-upload-btn {
      display: inline-block;
      padding: 12px 24px;
      background: var(--primary);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 15px;
      border: none;
      font-size: 16px;
      font-weight: 600;
    }

    .file-upload-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .file-list {
      margin-top: 20px;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 10px 15px;
      margin-bottom: 10px;
      font-size: 14px;
      animation: fadeIn 0.3s ease;
    }

    .file-item-content {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .file-icon {
      color: var(--primary);
      font-size: 16px;
    }

    .file-name {
      font-weight: 500;
    }

    .file-size {
      color: var(--secondary);
      font-size: 12px;
      margin-left: 8px;
    }

    .remove-btn {
      background: none;
      border: none;
      color: var(--danger);
      font-size: 16px;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: var(--transition);
    }

    .remove-btn:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .upload-error-message {
      background-color: #ffebee;
      padding: 12px;
      border-radius: 6px;
      margin-top: 15px;
      border-left: 4px solid var(--danger);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .upload-error-message i {
      color: var(--danger);
    }

    .form-navigation {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background-color: #475569;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #formMessage {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      display: none;
      animation: fadeIn 0.5s ease;
    }

    #formMessage.success {
      background-color: #ecfdf5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }

    #formMessage.error {
      background-color: #fef2f2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }

    .review-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }

    .review-label {
      font-weight: 600;
      color: var(--secondary);
      margin-bottom: 5px;
      font-size: 14px;
    }

    .review-value {
      color: var(--dark);
      font-size: 16px;
    }

    .review-files {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .review-file-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 0;
    }

    /* Success Screen Styles */
    .success-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s ease;
    }

    .success-screen.active {
      opacity: 1;
      visibility: visible;
    }

    .success-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.5s ease;
    }

    .success-screen.active .success-content {
      transform: translateY(0);
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: scaleIn 0.5s ease;
    }

    .success-icon i {
      color: white;
      font-size: 40px;
    }

    @keyframes scaleIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .success-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 15px;
    }

    .success-message {
      font-size: 16px;
      color: var(--dark);
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .success-details {
      background: #f8fafc;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      text-align: left;
    }

    .success-detail {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
    }

    .success-detail:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: var(--secondary);
    }

    .detail-value {
      color: var(--dark);
    }

    .countdown {
      font-size: 14px;
      color: var(--secondary);
      margin-top: 20px;
    }

    .countdown-number {
      display: inline-block;
      width: 25px;
      height: 25px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 25px;
      margin: 0 5px;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .form-container {
        padding: 20px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .progress-bar {
        margin-bottom: 20px;
      }
      
      .step-label {
        display: none;
      }
      
      .file-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .file-item-content {
        width: 100%;
      }
      
      .success-content {
        padding: 25px;
      }
      
      .success-title {
        font-size: 20px;
      }
    }

    /* Loading animation */
    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      display: inline-block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error-message {
      color: var(--danger);
      font-size: 14px;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    
    /* Success Screen Styles */
    .success-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s ease;
    }

    .success-screen.active {
      opacity: 1;
      visibility: visible;
    }

    .success-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.5s ease;
    }

    .success-screen.active .success-content {
      transform: translateY(0);
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: scaleIn 0.5s ease;
    }

    .success-icon i {
      color: white;
      font-size: 40px;
    }

    @keyframes scaleIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .success-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--success);
      margin-bottom: 15px;
    }

    .success-message {
      font-size: 16px;
      color: var(--dark);
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .success-details {
      background: #f8fafc;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      text-align: left;
    }

    .success-detail {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
    }

    .success-detail:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: var(--secondary);
    }

    .detail-value {
      color: var(--dark);
    }

    .countdown {
      font-size: 14px;
      color: var(--secondary);
      margin-top: 20px;
    }

    .countdown-number {
      display: inline-block;
      width: 25px;
      height: 25px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 25px;
      margin: 0 5px;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .success-content {
        padding: 25px;
      }
      
      .success-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <header>
<img src="Public/nbhrc_logo1.jpg" alt="Company Logo" class="logo" />
      <h1>Home Builder Submission Form</h1>
      
      <div class="progress-bar" id="progressBar">
        <div class="progress-line"></div>
        <div class="step-progress active" id="step1Progress">
          1
          <span class="step-label">Basic Info</span>
        </div>
        <div class="step-progress" id="step2Progress">
          2
          <span class="step-label">Property Details</span>
        </div>
        <div class="step-progress" id="step3Progress">
          3
          <span class="step-label">Documents</span>
        </div>
        <div class="step-progress" id="step4Progress">
          4
          <span class="step-label">Review</span>
        </div>
      </div>
    </header>

    <form id="homeBuilderForm" novalidate>
      <!-- Step 1 -->
      <section class="form-section active" id="step1">
        <div class="section-title">
          <i class="fas fa-user"></i>
          <span>Basic Information</span>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="province" class="required">Province</label>
            <div class="input-container">
              <select id="province" name="province" required>
                <option value="" disabled selected>Select your province</option>
                <option>Eastern Cape</option>
                <option>Free State</option>
                <option>Gauteng</option>
                <option>KwaZulu Natal</option>
                <option>Limpopo</option>
                <option>Mpumalanga</option>
                <option>North West</option>
                <option>Northern Cape</option>
                <option>Western Cape</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="builderName" class="required">Home Builder Name and Surname</label>
            <div class="input-container">
              <input type="text" id="builderName" name="builderName" required placeholder="Enter full name" />
            </div>
          </div>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="companyName" class="required">Home Builder Company Name</label>
            <div class="input-container">
              <input type="text" id="companyName" name="companyName" required placeholder="Enter company name" />
            </div>
          </div>
          
          <div class="form-group">
            <label for="registrationNumber" class="required">Home Builder Registration Number</label>
            <div class="input-container">
              <input type="text" id="registrationNumber" name="registrationNumber" required placeholder="Enter registration number" />
            </div>
          </div>
        </div>
        
        <div class="form-navigation">
          <div></div>
          <button type="button" class="btn btn-primary" onclick="nextStep()">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="form-section" id="step2">
        <div class="section-title">
          <i class="fas fa-home"></i>
          <span>Property Details</span>
        </div>
        
        <div class="form-group">
          <label for="propertyDetails" class="required">Property Details</label>
          <div class="input-container">
            <textarea id="propertyDetails" name="propertyDetails" rows="4" required placeholder="Enter full property address and details"></textarea>
          </div>
        </div>
        
        <div class="form-group">
          <label for="competentPerson" class="required">Competent Person Name</label>
          <div class="input-container">
            <input type="text" id="competentPerson" name="competentPerson" required placeholder="Enter competent person's name" />
          </div>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="button" class="btn btn-primary" onclick="nextStep()">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="form-section" id="step3">
        <div class="section-title">
          <i class="fas fa-file-upload"></i>
          <span>Upload Documents</span>
        </div>
        
        <div class="form-group">
          <label for="fileUpload" class="required">Upload D1 Form and Appendices</label>
          <div class="file-upload-container" id="fileDropArea">
            <div class="file-upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <p>Drag & drop files here or click to browse</p>
            <small>Max 10 files, formats: Word, Excel, PDF, Image, etc. (Max 10MB each)</small>
            <input type="file" id="fileUpload" name="fileUpload" multiple class="file-input" />
          </div>

          <!-- File preview list -->
          <div class="file-list" id="fileList"></div>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="button" class="btn btn-primary" onclick="if(validateStep(3)){nextStep();}">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </section>

      <!-- Step 4 -->
      <section class="form-section" id="step4">
        <div class="section-title">
          <i class="fas fa-check-circle"></i>
          <span>Review Information</span>
        </div>
        
        <p>Please review your information before submitting.</p>
        
        <div class="review-item">
          <div class="review-label">Province</div>
          <div class="review-value" id="reviewProvince"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Builder Name</div>
          <div class="review-value" id="reviewBuilderName"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Company Name</div>
          <div class="review-value" id="reviewCompanyName"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Registration Number</div>
          <div class="review-value" id="reviewRegistrationNumber"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Property Details</div>
          <div class="review-value" id="reviewPropertyDetails"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Competent Person</div>
          <div class="review-value" id="reviewCompetentPerson"></div>
        </div>
        
        <div class="review-item">
          <div class="review-label">Files to Upload</div>
          <div class="review-value review-files" id="reviewFiles"></div>
        </div>
        
        <div class="form-navigation">
          <button type="button" class="btn btn-secondary" onclick="prevStep()">
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button type="submit" id="submitBtn" class="btn btn-primary">
            <i class="fas fa-paper-plane"></i> Submit Form
          </button>
        </div>
      </section>
    </form>

    <div id="formMessage"></div>
  </div>

  <!-- Success Screen -->
  <div class="success-screen" id="successScreen">
    <div class="success-content">
      <div class="success-icon">
        <i class="fas fa-check"></i>
      </div>
      <h2 class="success-title">Submission Successful!</h2>
      <p class="success-message">Thank you for completing the Home Builder Submission Form. Your information has been successfully submitted to the NHBRC.</p>
      
      <div class="success-details">
        <div class="success-detail">
          <span class="detail-label">Reference ID:</span>
          <span class="detail-value" id="successRefId">HB-${Math.floor(100000 + Math.random() * 900000)}</span>
        </div>
        <div class="success-detail">
          <span class="detail-label">Submitted on:</span>
          <span class="detail-value" id="successDate">${new Date().toLocaleString()}</span>
        </div>
      </div>
      
      <p class="countdown">This screen will close in <span class="countdown-number" id="countdown">5</span> seconds</p>
      
      <button class="btn btn-primary" onclick="closeSuccessScreen()">
        <i class="fas fa-times"></i> Close Now
      </button>
    </div>
  </div>

<script>
  let currentStep = 1;
  const totalSteps = 4;
  let uploadedFiles = [];

  let countdownInterval;
  let countdownValue = 5;

  // Initialize the form
  document.addEventListener('DOMContentLoaded', function() {
    showStep(currentStep);
    updateProgressBar();
    setupFileUpload();
  });

  function showStep(step) {
    document.querySelectorAll('.form-section').forEach((section, index) => {
      section.classList.toggle('active', index === step - 1);
    });
    
    updateProgressBar();
    
    // Update review section when on the last step
    if (step === 4) {
      updateReviewSection();
    }
  }

  function updateProgressBar() {
    document.querySelectorAll('.step-progress').forEach((progress, index) => {
      progress.classList.remove('active', 'completed');
      
      if (index + 1 < currentStep) {
        progress.classList.add('completed');
      } else if (index + 1 === currentStep) {
        progress.classList.add('active');
      }
    });
    
    // Update progress line
    const progressPercent = ((currentStep - 1) / (totalSteps - 1)) * 100;
    document.querySelector('.progress-line').style.width = `${progressPercent}%`;
  }

  function validateStep(step) {
    const currentSection = document.querySelector(`#step${step}`);
    const inputs = currentSection.querySelectorAll('input, select, textarea');
    let isValid = true;
    
    // Clear previous error messages
    currentSection.querySelectorAll('.error-message').forEach(el => el.remove());
    inputs.forEach(input => input.classList.remove('error'));
    
    for (const input of inputs) {
      if (input.hasAttribute('required') && !input.value.trim()) {
        input.classList.add('error');
        isValid = false;
        
        const errorMsg = document.createElement('div');
        errorMsg.className = 'error-message';
        errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> This field is required';
        input.parentNode.appendChild(errorMsg);
      }
    }
    
    // Special validation for step 3 (file upload)
    if (step === 3) {
      const uploadContainer = document.getElementById('fileDropArea');
      let errorMsg = uploadContainer.querySelector('.upload-error-message');
      
      if (uploadedFiles.length === 0) {
        isValid = false;
        
        if (!errorMsg) {
          errorMsg = document.createElement('div');
          errorMsg.className = 'upload-error-message';
          errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please upload at least one file';
          uploadContainer.appendChild(errorMsg);
        }
      } else if (errorMsg) {
        errorMsg.remove();
      }
    }
    
    return isValid;
  }

  function nextStep() {
    if (!validateStep(currentStep)) {
      return;
    }
    
    if (currentStep < totalSteps) {
      currentStep++;
      showStep(currentStep);
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      currentStep--;
      showStep(currentStep);
    }
  }

  // Show the success screen
  function showSuccessScreen() {
    const successScreen = document.getElementById('successScreen');
    const successRefId = document.getElementById('successRefId');
    const successDate = document.getElementById('successDate');
    const countdownElement = document.getElementById('countdown');
    
    // Generate random reference ID
    successRefId.textContent = `HB-${Math.floor(100000 + Math.random() * 900000)}`;
    
    // Set current date
    successDate.textContent = new Date().toLocaleString();
    
    // Show the success screen
    successScreen.classList.add('active');
    
    // Start countdown
    countdownValue = 5;
    countdownElement.textContent = countdownValue;
    
    clearInterval(countdownInterval);
    countdownInterval = setInterval(() => {
      countdownValue--;
      countdownElement.textContent = countdownValue;
      
      if (countdownValue <= 0) {
        closeSuccessScreen();
      }
    }, 1000);
  }
  
  // Close the success screen
  function closeSuccessScreen() {
    const successScreen = document.getElementById('successScreen');
    successScreen.classList.remove('active');
    clearInterval(countdownInterval);
  }

  function setupFileUpload() {
    const fileInput = document.getElementById('fileUpload');
    const fileDropArea = document.getElementById('fileDropArea');
    const fileList = document.getElementById('fileList');
    
    // Click to select files
    fileDropArea.addEventListener('click', function(e) {
      if (!e.target.classList.contains('file-remove')) {
        fileInput.click();
      }
    });

    // Drag and drop events
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileDropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
      fileDropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      fileDropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
      fileDropArea.style.borderColor = 'var(--primary)';
      fileDropArea.style.backgroundColor = '#e0f2ff';
    }

    function unhighlight() {
      fileDropArea.style.borderColor = '#cbd5e1';
      fileDropArea.style.backgroundColor = '#f8fafc';
    }

    // Handle dropped files
    fileDropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    }

    // Handle file selection via browse
    fileInput.addEventListener('change', function() {
      handleFiles(this.files);
      this.value = ''; // Reset input to allow selecting same file again
    });

    function handleFiles(files) {
      if (files.length === 0) return;

      // Check total files limit
      if (uploadedFiles.length + files.length > 10) {
        showMessage('You can upload a maximum of 10 files', 'error');
        return;
      }

      for (let i = 0; i < files.length; i++) {
        const file = files[i];

        // Check file size (10MB max)
        if (file.size > 10 * 1024 * 1024) {
          showMessage(`File "${file.name}" is too large. Max size is 10MB.`, 'error');
          continue;
        }

        // Check file type
        const allowedExtensions = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.jpg', '.jpeg', '.png', '.gif'];
        const fileExtension = '.' + file.name.toLowerCase().split('.').pop();
        if (!allowedExtensions.includes(fileExtension)) {
          showMessage(`File "${file.name}" is not a supported format.`, 'error');
          continue;
        }

        // Avoid duplicates
        const exists = uploadedFiles.some(f => f.name === file.name && f.size === file.size);
        if (!exists) {
          uploadedFiles.push(file);
          displayFile(file);
        }
      }
      
      // Clear any upload error messages
      const errorMsg = fileDropArea.querySelector('.upload-error-message');
      if (errorMsg) {
        errorMsg.remove();
      }
    }

    function displayFile(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      
      const fileItemContent = document.createElement('div');
      fileItemContent.className = 'file-item-content';
      
      // Determine file icon based on extension
      const ext = file.name.split('.').pop().toLowerCase();
      let iconClass = 'fas fa-file';
      let iconColor = '#2563eb';
      
      if (['jpg', 'jpeg', 'png', 'gif', 'bmp'].includes(ext)) {
        iconClass = 'fas fa-file-image';
        iconColor = '#4CAF50';
      } else if (ext === 'pdf') {
        iconClass = 'fas fa-file-pdf';
        iconColor = '#FF5252';
      } else if (['doc', 'docx'].includes(ext)) {
        iconClass = 'fas fa-file-word';
        iconColor = '#2196F3';
      } else if (['xls', 'xlsx'].includes(ext)) {
        iconClass = 'fas fa-file-excel';
        iconColor = '#4CAF50';
      }
      
      const fileIcon = document.createElement('i');
      fileIcon.className = iconClass + ' file-icon';
      fileIcon.style.color = iconColor;
      
      const fileName = document.createElement('span');
      fileName.className = 'file-name';
      fileName.textContent = file.name;
      
      const fileSize = document.createElement('span');
      fileSize.className = 'file-size';
      fileSize.textContent = formatFileSize(file.size);
      
      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-btn';
      removeBtn.innerHTML = '<i class="fas fa-times"></i>';
      removeBtn.title = 'Remove file';
      removeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        // Remove from uploadedFiles array
        uploadedFiles = uploadedFiles.filter(f => !(f.name === file.name && f.size === file.size));
        // Remove from DOM
        fileItem.remove();
      });
      
      fileItemContent.appendChild(fileIcon);
      fileItemContent.appendChild(fileName);
      fileItemContent.appendChild(fileSize);
      fileItem.appendChild(fileItemContent);
      fileItem.appendChild(removeBtn);
      
      fileList.appendChild(fileItem);
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  }

  function updateReviewSection() {
    // Update review section with form values
    document.getElementById('reviewProvince').textContent = document.getElementById('province').value || 'Not provided';
    document.getElementById('reviewBuilderName').textContent = document.getElementById('builderName').value || 'Not provided';
    document.getElementById('reviewCompanyName').textContent = document.getElementById('companyName').value || 'Not provided';
    document.getElementById('reviewRegistrationNumber').textContent = document.getElementById('registrationNumber').value || 'Not provided';
    document.getElementById('reviewPropertyDetails').textContent = document.getElementById('propertyDetails').value || 'Not provided';
    document.getElementById('reviewCompetentPerson').textContent = document.getElementById('competentPerson').value || 'Not provided';
    
    // Update files review
    const reviewFiles = document.getElementById('reviewFiles');
    reviewFiles.innerHTML = '';
    
    if (uploadedFiles.length === 0) {
      reviewFiles.textContent = 'No files uploaded';
    } else {
      uploadedFiles.forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'review-file-item';
        
        const ext = file.name.split('.').pop().toLowerCase();
        let iconClass = 'fas fa-file';
        
        if (['jpg', 'jpeg', 'png', 'gif', 'bmp'].includes(ext)) {
          iconClass = 'fas fa-file-image';
        } else if (ext === 'pdf') {
          iconClass = 'fas fa-file-pdf';
        } else if (['doc', 'docx'].includes(ext)) {
          iconClass = 'fas fa-file-word';
        } else if (['xls', 'xlsx'].includes(ext)) {
          iconClass = 'fas fa-file-excel';
        }
        
        fileItem.innerHTML = `
          <i class="${iconClass}" style="color: #2563eb;"></i>
          <span>${file.name} (${formatFileSize(file.size)})</span>
        `;
        reviewFiles.appendChild(fileItem);
      });
    }
  }
  
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  function showMessage(message, type) {
    const formMessage = document.getElementById('formMessage');
    formMessage.textContent = message;
    formMessage.className = type;
    formMessage.style.display = 'block';
    
    // Auto hide after 5 seconds
    setTimeout(() => {
      formMessage.style.display = 'none';
    }, 5000);
  }

  document.getElementById('homeBuilderForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const formMessage = document.getElementById('formMessage');
    const submitBtn = document.getElementById('submitBtn');

    // Validate all steps before submission
    for (let step = 1; step <= 3; step++) {
      if (!validateStep(step)) {
        showMessage('Please complete all required fields correctly', 'error');
        return;
      }
    }

    // Disable button to prevent double clicks
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner"></span> Submitting...';

    // Create FormData to send files + fields
    const formData = new FormData();
    
    // Add form fields
    formData.append('province', document.getElementById('province').value);
    formData.append('builderName', document.getElementById('builderName').value);
    formData.append('companyName', document.getElementById('companyName').value);
    formData.append('registrationNumber', document.getElementById('registrationNumber').value);
    formData.append('propertyDetails', document.getElementById('propertyDetails').value);
    formData.append('competentPerson', document.getElementById('competentPerson').value);
    
    // Append all uploaded files
    uploadedFiles.forEach((file, index) => {
      formData.append(`fileUpload[${index}]`, file);
    });

    formMessage.style.display = 'none';
    formMessage.textContent = '';
    formMessage.className = '';

    try {
      const response = await fetch('/api/submit-form', {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        // Handle server errors (4xx, 5xx)
        throw new Error(data.error || `Server returned ${response.status}`);
      }
      
      if (data.success) {
        // Show the success screen instead of just a message
        showSuccessScreen();
        
        // Reset form after successful submission
        form.reset();
        uploadedFiles = [];
        document.getElementById('fileList').innerHTML = '';
        currentStep = 1;
        showStep(currentStep);
      } else {
        showMessage('Error: ' + (data.error || 'Unknown error'), 'error');
      }
    } catch (err) {
      console.error('Submission error:', err);
      showMessage('An error occurred while submitting. Please try again. ' + err.message, 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Form';
    }
  });
</script>
  
</body>
</html>